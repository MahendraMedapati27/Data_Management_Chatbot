{% extends "base.html" %}

{% block title %}Verify Email - Quantum Blue{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card shadow-lg">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
                    <h3 class="card-title">Verify Your Email</h3>
                    <p class="text-muted">We've sent a 6-digit code to</p>
                    <p class="text-primary"><strong>{{ email }}</strong></p>
                </div>

                <form method="POST" action="{{ url_for('auth.verify_otp') }}">
                    <div class="mb-4">
                        <label for="otp" class="form-label">Enter OTP Code</label>
                        <input 
                            type="text" 
                            class="form-control form-control-lg text-center" 
                            id="otp" 
                            name="otp" 
                            maxlength="6"
                            pattern="[0-9]{6}"
                            placeholder="000000"
                            required
                            autofocus
                            style="letter-spacing: 0.5em; font-size: 24px; font-weight: bold;">
                        <div class="form-text">Enter the 6-digit code from your email</div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                        <i class="fas fa-check-circle"></i> Verify Email
                    </button>
                </form>

                <div class="text-center">
                    <p class="text-muted mb-2">Didn't receive the code?</p>
                    <form method="POST" action="{{ url_for('auth.resend_otp') }}" class="d-inline">
                        <button type="submit" class="btn btn-link" id="resendBtn">
                            <i class="fas fa-redo"></i> Resend OTP
                        </button>
                    </form>
                    <div id="countdown" class="text-muted small mt-2"></div>
                </div>

                <hr class="my-4">

                <div class="alert alert-info small mb-0">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Note:</strong> The OTP is valid for 10 minutes. 
                    Check your spam folder if you don't see it.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-format OTP input
document.getElementById('otp').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '');
});

// Countdown timer for resend button
let countdown = 60;
const resendBtn = document.getElementById('resendBtn');
const countdownDiv = document.getElementById('countdown');

function startCountdown() {
    resendBtn.disabled = true;
    const timer = setInterval(() => {
        countdown--;
        countdownDiv.textContent = `You can resend OTP in ${countdown} seconds`;
        
        if (countdown <= 0) {
            clearInterval(timer);
            resendBtn.disabled = false;
            countdownDiv.textContent = '';
            countdown = 60;
        }
    }, 1000);
}

// Start countdown on page load
if (countdown === 60) {
    startCountdown();
}

// Restart countdown on resend
resendBtn.addEventListener('click', function() {
    if (!this.disabled) {
        startCountdown();
    }
});
</script>
{% endblock %}